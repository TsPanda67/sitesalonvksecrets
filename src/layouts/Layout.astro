---
// src/layouts/Layout.astro
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import '../styles/global.css';

export interface Props {
  title: string;
  description?: string;
  image?: string;
  type?: 'website' | 'article';
  noIndex?: boolean;
}

const { 
  title: pageTitle,
  description: pageDescription,
  image: pageImage,
  type: ogType = 'website',
  noIndex = false,
} = Astro.props;

// Utilisation de Astro.site qui est défini dans votre astro.config.mjs
const siteUrl = Astro.site ? Astro.site.toString().replace(/\/$/, "") : Astro.url.origin.replace(/\/$/, ""); // Enlève le / final
const canonicalURL = new URL(Astro.url.pathname, siteUrl).href;

const siteName = "Salon VK Secrets"; // Nom du site pour OpenGraph, etc.
const fullSiteTitle = `${siteName} - Strasbourg Neuhof`; // Titre du site global avec localité

const defaultDescription = `Salon VK Secrets à Strasbourg Neuhof : votre institut de beauté exclusivement féminin. Massages bien-être, épilations douces, soins du corps et onglerie. Prise de RDV au 07 83 96 05 43.`;
const effectiveDescription = pageDescription || defaultDescription;

// Votre logo est dans public/img/logo-vksecrets.png
const logoUrl = new URL("/img/logo-vksecrets.png", siteUrl).href; 
// Pour og:image, il est recommandé d'avoir une image dédiée (1200x630px). Si vous n'en avez pas, le logo peut être un fallback mais moins idéal.
// Je vais supposer que vous créerez une public/og-image.jpg.
const ogImageDefault = new URL("/og-image.jpg", siteUrl).href; 
const effectiveOgImage = pageImage ? new URL(pageImage, siteUrl).href : ogImageDefault;

const fullPageTitle = `${pageTitle} | ${fullSiteTitle}`;

// Schema.org Data
const schemaData = {
  "@context": "https://schema.org",
  "@type": "BeautySalon",
  "name": siteName,
  "image": logoUrl, // Utilisation de votre logo existant
  "url": siteUrl, // Utilisation de Astro.site
  "telephone": "+33783960543",
  "priceRange": "€€",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "85 Route d'Altenheim",
    "addressLocality": "Strasbourg", // Ville
    "postalCode": "67100",
    "addressRegion": "Grand Est", // Région administrative. "Neuhof" est un quartier.
    "addressCountry": "FR"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": "48.5366688", // Votre latitude exacte
    "longitude": "7.7708362"  // Votre longitude exacte
  },
  "openingHoursSpecification": [ // Vos horaires exacts
    { "@type": "OpeningHoursSpecification", "dayOfWeek": "Monday", "opens": "10:00", "closes": "20:30" },
    { "@type": "OpeningHoursSpecification", "dayOfWeek": "Tuesday", "opens": "10:00", "closes": "17:00" },
    // Mercredi est fermé, donc on ne le met pas pour éviter la confusion. Indiquez "fermé le mercredi" sur la page contact.
    { "@type": "OpeningHoursSpecification", "dayOfWeek": "Thursday", "opens": "10:00", "closes": "20:30" },
    { "@type": "OpeningHoursSpecification", "dayOfWeek": "Friday", "opens": "10:00", "closes": "20:30" },
    { "@type": "OpeningHoursSpecification", "dayOfWeek": ["Saturday", "Sunday"], "description": "Sur rendez-vous uniquement" }
    // Pour les jours "sur demande", une description est plus appropriée que des horaires fictifs.
  ],
  "sameAs": [ // URLs canoniques propres
    "https://www.facebook.com/salonvksecrets", // Assurez-vous que c'est le bon lien
    "https://www.instagram.com/salonvksecrets/" // Assurez-vous que c'est le bon lien
  ],
  "description": defaultDescription // Utilisation de la description par défaut du site pour le schema
};
---

<!doctype html>
<html lang="fr" class="scroll-smooth">
  <head>
    <meta name="google-site-verification" content="YpZUs4ECOol5g31enn7TeK7e3KCUVIk4Vnk8G_ScigU" />
    
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />
    {noIndex && <meta name="robots" content="noindex, nofollow" />}
    
    <title>{fullPageTitle}</title>
    <meta name="description" content={effectiveDescription} />
    
    <!-- Favicon pour onglet navigateur -->
    <link rel="icon" type="image/png" sizes="32x32" href="/img/logo-vksecrets-112.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/logo-vksecrets-112.png">
    <link rel="icon" type="image/png" href="/img/logo-vksecrets-112.png">
    <!-- Logo pour Google (données structurées Schema.org) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "https://salonvksecrets.com",
      "logo": "https://salonvksecrets.com/img/logo-vksecrets-112.png"
    }
    </script>

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"> {/* Créer public/apple-touch-icon.png (180x180) */}
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"> {/* Créer public/favicon-32x32.png */}
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"> {/* Créer public/favicon-16x16.png */}
    <link rel="manifest" href="/site.webmanifest"> {/* Optionnel: Créer public/site.webmanifest pour PWA */}
    <meta name="theme-color" content="#EDA9A1"> {/* Votre primary-500 */}

    <link rel="canonical" href={canonicalURL} />
    
    <!-- Optimisation Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet" media="all" />
    <!-- Fin optimisation Google Fonts -->
    
    <!-- Google Tag Manager en defer (si présent) -->
    <script src="https://www.googletagmanager.com/gtag/js?id=G-WXSYG181YV" defer></script>
    <!-- Fin GTM defer -->

    <meta property="og:title" content={fullPageTitle} />
    <meta property="og:description" content={effectiveDescription} />
    <meta property="og:type" content={ogType} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:image" content={effectiveOgImage} />
    <meta property="og:image:alt" content={`Image de présentation pour ${pageTitle} - ${siteName}`} />
    <meta property="og:site_name" content={siteName} />
    <meta property="og:locale" content="fr_FR" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={fullPageTitle} />
    <meta name="twitter:description" content={effectiveDescription} />
    <meta name="twitter:image" content={effectiveOgImage} />
    <meta name="twitter:image:alt" content={`Image de présentation pour ${pageTitle} - ${siteName}`} />
    
    <script type="application/ld+json" set:html={JSON.stringify(schemaData)} />

  </head>
  <body class="font-sans text-text-dark bg-background-light antialiased">
    <div class="min-h-screen flex flex-col">
      <Header />

      <!-- Menu mobile overlay global, recouvre toute la page -->
      <div id="mobileMenu" class="fixed inset-0 bg-white/95 z-[999] flex flex-col items-center h-full w-full pt-24 px-6 pb-12 space-y-10 text-2xl font-display transition-all duration-300 opacity-0 pointer-events-none invisible md:hidden overflow-y-auto">
        <button id="closeMenuBtn" class="absolute top-6 right-6 text-4xl text-accent-900 hover:text-primary-500 focus:outline-none" aria-label="Fermer menu">&times;</button>
        <nav class="flex-1 flex flex-col justify-center w-full">
          <ul class="flex flex-col space-y-8 items-center w-full">
            <li class="w-full"><a href="/" class="block w-full text-center py-4 rounded-lg text-accent-900 hover:bg-primary-100 hover:text-primary-500 transition-colors text-2xl font-semibold" onclick="closeMobileMenu()">Accueil</a></li>
            <li class="w-full"><a href="/a-propos" class="block w-full text-center py-4 rounded-lg text-accent-900 hover:bg-primary-100 hover:text-primary-500 transition-colors text-2xl font-semibold" onclick="closeMobileMenu()">Mon histoire</a></li>
            <li class="w-full"><a href="/prestations" class="block w-full text-center py-4 rounded-lg text-accent-900 hover:bg-primary-100 hover:text-primary-500 transition-colors text-2xl font-semibold" onclick="closeMobileMenu()">Prestations</a></li>
            <li class="w-full"><a href="/contact" class="block w-full text-center py-4 rounded-lg text-accent-900 hover:bg-primary-100 hover:text-primary-500 transition-colors text-2xl font-semibold" onclick="closeMobileMenu()">Contact</a></li>
            <li class="w-full"><a href="/blog" class="block w-full text-center py-4 rounded-lg text-accent-900 hover:bg-primary-100 hover:text-primary-500 transition-colors text-2xl font-semibold" onclick="closeMobileMenu()">Blog</a></li>
          </ul>
        </nav>
        <a href="tel:+33783960543" class="mt-8 text-lg font-sans font-semibold text-accent-700 border-2 border-primary-300 rounded-full px-8 py-3 hover:bg-primary-100 hover:border-primary-400 transition-colors shadow-soft mb-4" onclick="closeMobileMenu()">07 83 96 05 43</a>
      </div>

      <main class="flex-grow">
        <slot />
      </main>
      <Footer />
    </div>
    
    <a 
      href="tel:+33783960543" 
      class="fixed bottom-5 right-5 z-[70] lg:hidden flex items-center justify-center bg-primary-500 text-white rounded-full p-3.5 shadow-medium hover:bg-primary-400 transition-all duration-300 ease-in-out hover-lift"
      aria-label="Appeler pour prendre rendez-vous"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
      </svg>
    </a>

    <script is:inline>
      function openMobileMenu() {
        const menu = document.getElementById('mobileMenu');
        if (menu) {
          menu.classList.add('opacity-100', 'pointer-events-auto', 'visible');
          menu.classList.remove('opacity-0', 'pointer-events-none', 'invisible');
        }
      }
      function closeMobileMenu() {
        const menu = document.getElementById('mobileMenu');
        if (menu) {
          menu.classList.remove('opacity-100', 'pointer-events-auto', 'visible');
          menu.classList.add('opacity-0', 'pointer-events-none', 'invisible');
        }
      }
      document.addEventListener('DOMContentLoaded', () => {
        const menuToggle = document.getElementById('menuToggleBtn');
        const closeBtn = document.getElementById('closeMenuBtn');
        if (menuToggle) {
          menuToggle.addEventListener('click', openMobileMenu);
        }
        if (closeBtn) {
          closeBtn.addEventListener('click', closeMobileMenu);
        }
        document.querySelectorAll('#mobileMenu a').forEach(link => {
          link.addEventListener('click', closeMobileMenu);
        });
      });
    </script>
  </body>
</html>